var remoht={init:function(){null!=sessionStorage.getItem("element")&&(sessionStorage.removeItem("element"),remoht.inicializa_datos_indice());$(document).ajaxStart(function(b){$(".spinner").fadeIn()}).ajaxStop(function(b){$(".spinner").fadeOut()});remoht.logged_in&&(remoht.get_devices(),remoht.open_channel(),remoht.get_resources());$("#resources-refresh").bind("click",function(b){b.preventDefault();remoht.get_resources()});remoht.setup_chart();remoht.logged_in||remoht.start_demo()},logged_in:!1,resource_logged_in:"",
resources:{},get_resources:function(){$.ajax("/resources/",{success:function(b,a,c){remoht.resources=b.resources;$("#resource_list li").each(function(b,a){0!=b&&$(a).remove()});for(i in b.resources)remoht.add_resource(i,b.resources[i])}})},add_resource:function(b,a){var c=ich.resource_line({resource:b,presence:a});remoht.toggle_presence(c,a);$("#resource_list").append(c);c.bind("click",function(a){var c=new Date,f="["+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()+"]: ";a.preventDefault();$.ajax("/device/",
{type:"POST",data:{resource:b},success:function(b,a,c){console.debug(f+"Created device!",b.device);remoht.add_device_to_list(b.device)}})})},show_ind_elems:function(b,a){var c=ich.resource_line({resource:b,presence:a});$("#ind_elem_list").append(c)},get_devices:function(){$.ajax("/device/",{success:function(b,a,c){$("#device_list").find("li").each(function(b,a){a=$(a);a.hasClass("nav-header")||a.remove()});for(i in b.devices)remoht.add_device_to_list(b.devices[i])}})},add_device_to_list:function(b){var a=
ich.device_line(b);remoht.toggle_presence(a,b.presence);$("#device_list").append(a);a.bind("click",function(a){a.preventDefault();old_logged_in_resource=remoht.resource_logged_in;new_logged_in_resource=b.resource;remoht.current_device_id=b.id;a=new Date;a="["+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()+"]: ";new_logged_in_resource!=old_logged_in_resource?(remoht.resource_logged_in=new_logged_in_resource,sessionStorage.setItem("logged",remoht.resource_logged_in),console.debug(a+"new current logged in resource is: ",
remoht.resource_logged_in),console.debug(a+"going to jump to log_to_device... "),$("#full_JID").text(""),$("#current_date").text(""),$("#temp").text(""),$("#light").text(""),remoht.log_to_device(b.id)):(remoht.resource_logged_in=new_logged_in_resource,console.debug(a+"logged in resource not changed. current logged in resource is: ",remoht.resource_logged_in),remoht.get_relays(b.id));sessionStorage.setItem("devicejid",b.jid);$("#device_header .device_name").text(b.jid+"/"+remoht.resource_logged_in)})},
toggle_presence:function(b,a){sessionStorage.getItem("element")?console.debug("pasar"):b&&("available"==a?(b.find(".label-important").hide(),b.find(".label-success").show()):(b.find(".label-important").show(),b.find(".label-success").hide()))},get_relays:function(b){$.ajax("/device/"+b+"/relay/",{success:function(a,c,d){c=new Date;c="["+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()+"]: ";console.debug(c+"sth with relays!",a.relays);remoht.show_relays(b,a.relays)}})},show_relays:function(b,a){var c=
new Date,d="["+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()+"]: ";console.debug(d+"Show relays!",a);c=$("#relay_list").text("");for(key in a){console.debug(d+"in for loop for relay:",key);var e=app.n("a",{href:"/device/"+b+"/relay/"+key,"class":"btn btn-large"},key),f=a[key];f?e.addClass("btn-primary"):e.removeClass("btn-primary");key_in=key;state_in=f;console.debug(d+"key_in  & state_in :",key_in,state_in);e.on("click",{key_:key_in,state_:state_in},function(a){a.preventDefault();a=a.data;console.debug(d+
"Relay clicked!!: ",a.key_,a.state_);remoht.toggle_relay(b,a.key_,a.state_)});c.append(e)}},toggle_relay:function(b,a,c){var d=new Date,d="["+d.getHours()+":"+d.getMinutes()+":"+d.getSeconds()+"]: ";console.debug(d+"Toggle relay!  (from)",a,c);$.ajax("/device/"+b+"/relay/"+a,{type:"POST",dataType:"json",data:{state:0==c?1:0},success:function(b,a,c){}})},log_to_device:function(b){var a=new Date,c="["+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()+"]: ";sessionStorage.setItem("device",b);console.debug(c+
"Logging to device... ",b);$.ajax("/device/"+b+"/login/",{type:"POST",dataType:"json",data:{device:b},success:function(b,a,f){console.debug(c+"Call to login page ok... ")}})},last_reading:{},cubism_source:function(b){return{metric:function(a,c){var d=b.metric(function(b,c,d,h){var k=[remoht.last_reading[a]];b=(c-b)/d;for(c=1;c<b;c++)k.push(k[0]);h(null,k)});d.toString=function(){return c};return d}}},setup_chart:function(){var b=cubism.context().serverDelay(0).clientDelay(0).step(2E4).size($("#chart").width()),
a=remoht.cubism_source(b),c=a.metric("temp_c","Temp \u00b0C"),d=a.metric("light_pct","Light"),e=b.horizon().height(30).mode("offset").extent([5,100]).colors(["#08519c","#3182bd","#bdd7e7","#6baed6"]),f=b.horizon().height(30).mode("offset").extent([5,100]).colors(["#ea9611","#f3ba5f","#f3ba5f","#ea9611"]);d3.select("#chart").call(function(a){a.append("div").attr("class","axis").call(b.axis().orient("top").ticks(d3.time.minutes,30).tickSubdivide(5));a.append("div").datum(c).attr("class","horizon").call(e);
a.append("div").datum(d).attr("class","horizon").call(f);a.append("div").attr("class","rule").call(b.rule())});b.on("focus",function(a){d3.selectAll(".value").style("right",null==a?null:b.size()-a+"px")})},channel_commands:{presence:function(b){var a=new Date,a="["+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()+"]: ";sessionStorage.getItem("element")?console.debug(a+"salir"):(console.debug(a+"Presence!",b.full_resource,b),null==remoht.resources[b.resource]&&remoht.add_resource(b.resource,b.presence),
remoht.resources[b.resource]=b.presence,remoht.toggle_presence($(".resource.res-"+b.resource).parent(),b.presence),$("#signed_JID").text(b.signed_jid))},get_relays:function(b){var a=new Date,a="["+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()+"]: ";console.debug(a+"processing the new relay data from channel!");remoht.show_relays(b.device_id,b.relays)},ind_elem_data:function(b){},relay_result:function(b){},list_data_streams:function(b){},get_readings:function(b){var a=new Date,a="["+a.getHours()+
":"+a.getMinutes()+":"+a.getSeconds()+"]: ";console.debug(a+"processing the new reading from channel!",b.datestamp_msg);sessionStorage.getItem("device")&&(remoht.current_device_id=sessionStorage.getItem("device"),$("#device_header .device_name").text(sessionStorage.getItem("devicejid")+"/"+sessionStorage.getItem("logged")));if(remoht.current_device_id!=b.device_id)console.debug("%s is not current device. Get reading info not for this device, will not be shown. Current device is %s",b.device_id,remoht.current_device_id);
else{b.light_pct=parseInt(b.light_pct);var a=(50*Math.max(0,Math.min(1,b.light_pct/100+Math.random()))).toFixed(1),c=(50*Math.max(0,Math.min(1,b.temp_c/100+Math.random()))).toFixed(1);sessionStorage.setItem("jid",b.jid);sessionStorage.setItem("datestamp",b.datestamp_data);sessionStorage.setItem("temp",b.temp_c);sessionStorage.setItem("light",b.light_pct);$("#full_JID").text(b.jid);$("#signed_JID").text(b.signed_jid);$("#current_date").text(b.datestamp_data);$("#temp").text(b.temp_c);$("#light").text(b.light_pct);
remoht.last_reading=b;if(sessionStorage.getItem("element")){var d=1,e=1;$("#chart").find("span").each(function(){$(this).hasClass("title")&&("Tercero"==$(this).text()&&(d=0),"Cuarto"==$(this).text()&&(e=0))});1==d&&(remoht.last_reading.nuevo=a);1==e&&(remoht.last_reading.nuevo2=c)}}},get_image:function(b){var a=new Date,a="["+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()+"]: ";console.debug(a+"processing the new device image from channel!",b.device_id);console.debug(sessionStorage.getItem("device"));
sessionStorage.getItem("element")&&(remoht.current_device_id=sessionStorage.getItem("device"));if(remoht.current_device_id!=b.device_id)console.debug("%s is not current device. Get reading info not for this device, will not be shown. Current device is %s",b.device_id,remoht.current_device_id);else if(sessionStorage.setItem("imagen",JSON.stringify(b.device_image)),null==sessionStorage.getItem("element"))console.log("p\u00e1gina principal1");else{console.log("p\u00e1gina detalle "+sessionStorage.getItem("element"));
a=$.map(b.device_image[sessionStorage.getItem("element")].ind_element_subelements_json,function(b,a){return a});console.debug("list of image keys ",a);var c=document.getElementById("nivel_1");if(""==c.innerHTML){$("#nivel_1 li").each(function(b,a){0!=b&&$(a).remove()});c.innerHTML=sessionStorage.getItem("element");var d=document.createElement("ul");c.appendChild(d);for(MBOX_item in a){var e=document.createElement("li");e.setAttribute("id","nivel_1"+MBOX_item);e.setAttribute("onclick",'$("#tab-nondiv-container").easytabs("select", "#nondiv-tab'+
MBOX_item+'")');e.setAttribute("data-jstree","{ 'opened' : false }");e.innerHTML=a[MBOX_item];d.appendChild(e);c=document.createElement("ul");c.setAttribute("data-jstree","{ 'type' : 'default' }");e.appendChild(c);var f=$.map(b.device_image[sessionStorage.getItem("element")].ind_element_subelements_json[a[MBOX_item]].ind_element_subelements_json,function(b,a){return a});console.debug("list of image keys 3 ",f);for(MBOX_item2 in f){e=document.createElement("li");e.setAttribute("id","nivel_1"+MBOX_item+
"_"+MBOX_item2);e.setAttribute("data-jstree",'{"type":"fichero" }');var g=f[MBOX_item2],h=b.device_image[sessionStorage.getItem("element")].ind_element_subelements_json[a[MBOX_item]].ind_element_subelements_json[g];e.setAttribute("title",g);var k=g.substring(0,4);"ind_"==k?e.innerHTML=g:(k="---------------------------".substring(g.length),e.innerHTML=g+k+h);c.appendChild(e)}}$("#arbol").jstree({types:{fichero:{icon:"jstree-file"},"default":{icon:"jstree-folder"}},plugins:["types","contextmenu"],contextmenu:{items:function(b){var a=
$("#arbol").jstree("get_selected");return $("#"+a).attr("title")?{Visualizar:{label:"Gr\u00e1fica",action:function(b){var c=$("#"+a).attr("title");$("#"+a).val();$("#chart").find("span").each(function(){if($(this).hasClass("title")&&("Tercero"==$(this).text()||"Cuarto"==$(this).text()))return $(this).text(c),!1})}},Modificar:{label:"Modificar"}}:[]}}});g=document.getElementById("containermio");f=document.createElement("form");f.setAttribute("id","tab-nondiv-container");f.setAttribute("class","tab-container");
g.appendChild(f);c=document.createElement("ul");c.setAttribute("class","etabs");division=document.createElement("div");division.setAttribute("class","field-container");division.setAttribute("id","detalle");f.appendChild(c);f.appendChild(division);for(MBOX_item in a){e=document.createElement("li");0==MBOX_item&&e.setAttribute("id","nondiv-default");e.setAttribute("class","tab");ancla=document.createElement("a");ancla.textContent=a[MBOX_item].substring(13);ancla.setAttribute("href","#nondiv-tab"+MBOX_item);
e.appendChild(ancla);c.appendChild(e);campo=document.createElement("fieldset");campo.setAttribute("id","nondiv-tab"+MBOX_item);f=$.map(b.device_image[sessionStorage.getItem("element")].ind_element_subelements_json[a[MBOX_item]].ind_element_subelements_json,function(b,a){return a});console.debug("list of image keys 3 ",f);for(MBOX_item2 in f)g=f[MBOX_item2],h=b.device_image[sessionStorage.getItem("element")].ind_element_subelements_json[a[MBOX_item]].ind_element_subelements_json[g],grupo=document.createElement("div"),
grupo.setAttribute("class","form-group"),d=document.createElement("label"),d.textContent=f[MBOX_item2],d.setAttribute("for","inp_"+MBOX_item+"_"+MBOX_item2),e=document.createElement("input"),e.setAttribute("type","text"),e.setAttribute("id","inp_"+MBOX_item+"_"+MBOX_item2),e.setAttribute("onchange","$(this).addClass('cambiado')"),k=g.substring(0,4),"ind_"!=k?e.setAttribute("value",h):e.setAttribute("disabled",!0),grupo.appendChild(d),grupo.appendChild(e),campo.appendChild(grupo);division.appendChild(campo)}$("#tab-nondiv-container").easytabs({tabs:".etabs li"})}}},
auth_login:function(b){var a=new Date,a="["+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()+"]: ";console.debug(a+"received auth login & device elems data from pi!");if(sessionStorage.getItem("element"))console.debug("salir");else{$("#ind_elem_list li").each(function(b,a){0!=b&&$(a).remove()});sessionStorage.setItem("industria",b.ind_elem_data.device_elements);for(var a=b.ind_elem_data.device_elements.length,c=0;c<=a;c++){var d=document.getElementById("ind_elem_list"),e=document.createElement("li"),
f=document.createElement("a");f.textContent=b.ind_elem_data.device_elements[c];"MACARBOX_FFG_ELEMENT"==b.ind_elem_data.device_elements[c]&&(f.setAttribute("onclick",'sessionStorage.setItem("element","'+b.ind_elem_data.device_elements[c]+'")'),f.setAttribute("href","/ind_elem/"));e.appendChild(f);e.setAttribute("id","ind_element_"+c);d.appendChild(e)}$("#full_JID").text(b.jid)}},tweet_feed:function(b){console.debug("received tweet feed from pi!");$("#twitter_feed").text(b)}},inicializa_datos:function(){remoht.mi_grafica();
$("#full_JID").text(sessionStorage.getItem("jid"));$("#current_date").text(sessionStorage.getItem("datestamp"));$("#temp").text(sessionStorage.getItem("temp"));$("#light").text(sessionStorage.getItem("light"));$("#device_header .device_name").text(sessionStorage.getItem("devicejid")+"/"+sessionStorage.getItem("logged"));if("string"==typeof sessionStorage.getItem("imagen")&&"undefined"!=sessionStorage.getItem("imagen")){console.debug("IMAGEN16");var b=$.map(JSON.parse(sessionStorage.getItem("imagen"))[sessionStorage.getItem("element")].ind_element_subelements_json,
function(b,a){return a});console.debug("list of image sesion ",b);var a=document.getElementById("nivel_1");if(""==a.innerHTML){$("#nivel_1 li").each(function(b,a){0!=b&&$(a).remove()});a.innerHTML=sessionStorage.getItem("element");var c=document.createElement("ul");a.appendChild(c);for(MBOX_item in b){var d=document.createElement("li");d.setAttribute("id","nivel_1"+MBOX_item);d.setAttribute("onclick",'$("#tab-nondiv-container").easytabs("select", "#nondiv-tab'+MBOX_item+'")');d.innerHTML=b[MBOX_item];
c.appendChild(d);a=document.createElement("ul");d.appendChild(a);var e=$.map(JSON.parse(sessionStorage.getItem("imagen"))[sessionStorage.getItem("element")].ind_element_subelements_json[b[MBOX_item]].ind_element_subelements_json,function(b,a){return a});console.debug("list of image sesion 3 ",e);for(MBOX_item2 in e){d=document.createElement("li");d.setAttribute("id","nivel_1"+MBOX_item+"_"+MBOX_item2);d.setAttribute("data-jstree",'{"type":"fichero" }');var f=e[MBOX_item2],g=JSON.parse(sessionStorage.getItem("imagen"))[sessionStorage.getItem("element")].ind_element_subelements_json[b[MBOX_item]].ind_element_subelements_json[f];
d.setAttribute("title",f);var h=f.substring(0,4);"ind_"==h?d.innerHTML=f:(h="---------------------------".substring(f.length),d.innerHTML=f+h+g);a.appendChild(d)}}}$("#arbol").jstree({types:{fichero:{icon:"jstree-file"},"default":{icon:"jstree-folder"}},plugins:["types","contextmenu"],contextmenu:{items:function(b){var a=$("#arbol").jstree("get_selected");return $("#"+a).attr("title")?{Visualizar:{label:"Gr\u00e1fica",action:function(b){var c=$("#"+a).attr("title");$("#"+a).val();$("#chart").find("span").each(function(){if($(this).hasClass("title")&&
("Tercero"==$(this).text()||"Cuarto"==$(this).text()))return $(this).text(c),!1})}},Modificar:{label:"Modificar"}}:[]}}});f=document.getElementById("containermio");e=document.createElement("form");e.setAttribute("id","tab-nondiv-container");e.setAttribute("class","tab-container");f.appendChild(e);a=document.createElement("ul");a.setAttribute("class","etabs");division=document.createElement("div");division.setAttribute("class","field-container");division.setAttribute("id","detalle");e.appendChild(a);
e.appendChild(division);for(MBOX_item in b){d=document.createElement("li");0==MBOX_item&&d.setAttribute("id","nondiv-default");d.setAttribute("class","tab");ancla=document.createElement("a");ancla.textContent=b[MBOX_item].substring(13);ancla.setAttribute("href","#nondiv-tab"+MBOX_item);d.appendChild(ancla);a.appendChild(d);campo=document.createElement("fieldset");campo.setAttribute("id","nondiv-tab"+MBOX_item);e=$.map(JSON.parse(sessionStorage.getItem("imagen"))[sessionStorage.getItem("element")].ind_element_subelements_json[b[MBOX_item]].ind_element_subelements_json,
function(b,a){return a});console.debug("list of image sesion 3 ",e);for(MBOX_item2 in e)f=e[MBOX_item2],g=JSON.parse(sessionStorage.getItem("imagen"))[sessionStorage.getItem("element")].ind_element_subelements_json[b[MBOX_item]].ind_element_subelements_json[f],grupo=document.createElement("div"),grupo.setAttribute("class","form-group"),c=document.createElement("label"),c.textContent=e[MBOX_item2],c.setAttribute("for","inp_"+MBOX_item+"_"+MBOX_item2),d=document.createElement("input"),d.setAttribute("type",
"text"),d.setAttribute("id","inp_"+MBOX_item+"_"+MBOX_item2),d.setAttribute("onchange","$(this).addClass('cambiado')"),h=f.substring(0,4),"ind_"!=h?d.setAttribute("value",g):d.setAttribute("disabled",!0),grupo.appendChild(c),grupo.appendChild(d),campo.appendChild(grupo);division.appendChild(campo)}$("#tab-nondiv-container").easytabs({tabs:".etabs li"});console.debug("antes llamada2")}remoht.open_channel()},inicializa_datos_indice:function(){if(sessionStorage.getItem("logged")){remoht.current_device_id=
sessionStorage.getItem("device");$("#full_JID").text(sessionStorage.getItem("jid"));$("#current_date").text(sessionStorage.getItem("datestamp"));$("#temp").text(sessionStorage.getItem("temp"));$("#light").text(sessionStorage.getItem("light"));$("#device_header .device_name").text(sessionStorage.getItem("devicejid")+"/"+sessionStorage.getItem("logged"));$("#ind_elem_list li").each(function(b,a){0!=b&&$(a).remove()});for(var b=sessionStorage.getItem("industria").split(","),a=b.length,c=0;c<=a;c++){var d=
document.getElementById("ind_elem_list"),e=document.createElement("li"),f=document.createElement("a");f.textContent=b[c];"MACARBOX_FFG_ELEMENT"==b[c]&&(f.setAttribute("onclick",'sessionStorage.setItem("element","'+b[c]+'")'),f.setAttribute("href","/ind_elem/"));e.appendChild(f);e.setAttribute("id","ind_element_"+c);d.appendChild(e)}}},cambios:function(){var b=[];$("#tab-nondiv-container").find(":input").each(function(){if($(this).hasClass("cambiado")){var a=this.id.indexOf("_",4),c=parseInt(this.id.substring(4,
a)),d=parseInt(this.id.substring(a+1)),a=$.map(JSON.parse(sessionStorage.getItem("imagen"))[sessionStorage.getItem("element")].ind_element_subelements_json,function(b,a){return a}),d=$.map(JSON.parse(sessionStorage.getItem("imagen"))[sessionStorage.getItem("element")].ind_element_subelements_json[a[c]].ind_element_subelements_json,function(b,a){return a})[d],e={};e.nivel1=a[c];e.nivel2=d;e.valor=this.value;b.push(e);console.debug("Modificaci\u00f3n: ",b[0].nivel1+"-"+b[0].nivel2+"-"+b[0].valor)}})},
mi_grafica:function(){var b=cubism.context().serverDelay(0).clientDelay(0).step(1E4).size($("#chart").width()),a=remoht.cubism_source(b),c=a.metric("temp_c","Temp \u00b0C"),d=a.metric("light_pct","Light"),e=a.metric("nuevo","Tercero"),f=a.metric("nuevo2","Cuarto"),g=b.horizon().height(30).mode("offset").extent([5,100]).colors(["#08519c","#3182bd","#bdd7e7","#6baed6"]),h=b.horizon().height(30).mode("offset").extent([5,100]).colors(["#ea9611","#f3ba5f","#f3ba5f","#ea9611"]),k=b.horizon().height(30).mode("offset").extent([5,
100]).colors(["#ea96ff","#f3baff","#f3baff","#ea96ff"]),l=b.horizon().height(30).mode("offset").extent([5,100]).colors(["#ea9600","#f3ba00","#f3ba00","#ea9600"]);d3.select("#chart").call(function(a){a.append("div").attr("class","axis").call(b.axis().orient("top").ticks(d3.time.minutes,30).tickSubdivide(5));a.append("div").datum(c).attr("class","horizon").call(g);a.append("div").datum(d).attr("class","horizon").call(h);a.append("div").datum(e).attr("class","horizon").call(k);a.append("div").datum(f).attr("class",
"horizon").call(l);a.append("div").attr("class","rule").call(b.rule())});b.on("focus",function(a){d3.selectAll(".value").style("right",null==a?null:b.size()-a+"px")})},mi_grafica_global:function(){var b=cubism.context().serverDelay(0).clientDelay(0).step(2E4).size($("#chart2").width()),a=b.horizon().extent([0,50]).height(60).mode("offset");a.metric(function(a){return b.metric(function(b,a,c,g){for(var h=[];+b<+a;)b=+b+c,h.push(50*Math.random());g(null,h)},a)});d3.select("#chart2").selectAll(".horizon").data(["global"]).enter().append("div").attr("class",
"horizon").call(a);d3.select("#cuerpo").append("div").attr("class","rule").call(b.rule());b.on("focus",function(a){d3.selectAll(".value").style("right",null==a?null:b.size()-a+"px")});a=b.axis();d3.select("#cuerpo").append("div").attr("class","axis").append("g").call(a)},mi_grafica_global2:function(){var b=cubism.context().serverDelay(0).clientDelay(0).step(1E4).size($("#chart2").width()).stop(),a=b.horizon().extent([0,65]).height(65).mode("offset"),c=[[2,64.64],[3,64.66],[4,64.52],[5,64.39],[6,64.23],
[7,64.2],[8,64.28],[9,64.27],[10,64.3],[11,64.235],[12,64.34],[13,64.5],[14,64.5499],[15,64.67],[16,64.7],[17,64.78],[18,64.81],[19,64.68],[21,64.72],[22,64.8],[23,64.87],[24,64.77],[25,64.715],[26,64.57],[27,64.77],[28,64.65],[29,64.78],[30,64.81],[31,64.76],[32,64.78],[33,64.77],[34,64.69],[35,64.69],[36,64.62],[37,64.57],[38,64.57],[39,64.59],[40,64.56],[41,64.62],[42,64.67],[43,64.62],[44,64.67],[45,64.54],[46,64.52],[47,64.5],[49,64.5],[50,64.52],[51,64.52],[52,64.52],[53,64.41],[54,64.36],[55,
64.305],[57,64.34],[58,64.34],[59,64.38],[61,64.35],[62,64.35],[64,64.35],[65,64.35],[66,64.32],[69,64.3196],[70,64.38],[71,64.38],[72,64.26],[73,64.21],[74,64.15],[75,64.15],[76,64.04],[77,63.96],[78,63.97],[79,63.89],[80,63.934],[81,63.99],[82,64],[83,63.91],[84,64.01],[86,64],[87,64.03],[88,64.03],[89,64.01],[91,64.03],[92,64.03],[93,64.1],[94,64.11],[95,64.13],[96,64.1],[97,64.075],[98,64.09],[99,64.07],[100,64.03],[101,64.03],[102,64.025],[104,64.03],[105,64.01],[106,64.08],[108,64.085],[109,
64.08],[110,64.065],[111,64.07],[112,64.03],[113,64.03],[114,64.06],[115,64.1],[116,64.085],[117,64.09],[118,64.14],[120,64.1],[121,64.055],[122,64.085],[123,64.08],[124,64.05],[125,64.07],[126,64.09],[127,64.06],[128,64.08],[129,64.09],[130,64.12],[131,64.12],[132,64.1],[133,64.12],[134,64.13],[135,64.19],[136,64.2],[137,64.21],[138,64.19],[139,64.205],[140,64.2],[141,64.24],[142,64.22],[143,64.2],[144,64.2],[145,64.2],[146,64.185],[147,64.18],[148,64.2],[149,64.2],[150,64.205],[151,64.24],[152,
64.225],[153,64.19],[154,64.255],[155,64.29],[156,64.26],[157,64.245],[158,64.25],[159,64.27],[160,64.29],[161,64.3],[162,64.31],[164,64.248],[165,64.23],[166,64.21],[167,64.2],[168,64.23],[169,64.23],[170,64.24],[173,64.22],[174,64.23],[176,64.249],[177,64.27],[178,64.28],[180,64.28],[181,64.26],[182,64.27],[185,64.31],[186,64.3],[187,64.3],[188,64.28],[191,64.295],[192,64.295],[194,64.32],[195,64.34],[196,64.36],[197,64.37],[198,64.41],[199,64.43],[200,64.44],[201,64.46],[202,64.45],[203,64.4],
[204,64.43],[205,64.44],[206,64.43],[207,64.43],[208,64.435],[209,64.47],[212,64.46],[213,64.46],[214,64.45],[215,64.45],[216,64.46],[217,64.5],[218,64.5],[219,64.52],[220,64.52],[221,64.5011],[222,64.52],[224,64.52],[225,64.4925],[226,64.5],[227,64.54],[228,64.61],[229,64.63],[230,64.63],[231,64.63],[232,64.73],[235,64.71],[236,64.76],[237,64.79],[238,64.8],[239,64.7675],[240,64.71],[241,64.67],[242,64.69],[243,64.66],[244,64.66],[245,64.62],[246,64.645],[247,64.62],[248,64.61],[249,64.59],[250,
64.59],[251,64.59],[252,64.59],[253,64.59],[254,64.59],[255,64.58],[256,64.62],[261,64.655],[262,64.65],[264,64.64],[265,64.65],[266,64.59],[267,64.56],[268,64.57],[269,64.59],[270,64.585],[271,64.56],[272,64.54],[273,64.56],[274,64.57],[275,64.59],[277,64.59],[278,64.61],[279,64.64],[280,64.65],[282,64.69],[283,64.67],[284,64.68],[285,64.66],[286,64.64],[287,64.58],[288,64.55],[289,64.55],[290,64.55],[292,64.5525],[293,64.57],[294,64.58],[295,64.58],[296,64.5905],[297,64.57],[298,64.55],[300,64.56],
[301,64.59],[302,64.61],[304,64.62],[305,64.62],[306,64.635],[307,64.64],[308,64.639],[309,64.639],[310,64.65],[311,64.67],[312,64.7],[313,64.69],[314,64.71],[315,64.7],[316,64.72],[317,64.73],[318,64.69],[320,64.72],[321,64.74],[322,64.81],[323,64.78],[324,64.78],[325,64.77],[326,64.77],[327,64.8],[328,64.8],[329,64.775],[330,64.73],[331,64.75],[333,64.72],[334,64.71],[335,64.7175],[336,64.73],[337,64.74],[338,64.8],[339,64.84],[340,64.8],[341,64.78],[342,64.8],[344,64.81],[345,64.83],[346,64.83],
[347,64.87],[349,64.87],[351,64.92],[352,64.88],[353,64.88],[354,64.88],[355,64.86],[356,64.8699],[357,64.805],[358,64.81],[359,64.8],[360,64.74],[361,64.75],[364,64.8],[365,64.78],[366,64.79],[368,64.805],[369,64.78],[371,64.795],[372,64.78],[373,64.76],[374,64.77],[376,64.78],[377,64.78],[378,64.7798],[379,64.77],[380,64.74],[381,64.75],[382,64.75],[383,64.75],[384,64.73],[385,64.75],[386,64.78],[387,64.755],[388,64.76],[393,64.77],[2,64.64],[3,64.66],[4,64.52],[5,64.39],[6,64.23],[7,64.2],[8,64.28],
[9,64.27],[10,64.3],[11,64.235],[12,64.34],[13,64.5],[14,64.5499],[15,64.67],[16,64.7],[17,64.78],[18,64.81],[19,64.68],[21,64.72],[22,64.8],[23,64.87],[24,64.77],[25,64.715],[26,64.57],[27,64.77],[28,64.65],[29,64.78],[30,64.81],[31,64.76],[32,64.78],[33,64.77],[34,64.69],[35,64.69],[36,64.62],[37,64.57],[38,64.57],[39,64.59],[40,64.56],[41,64.62],[42,64.67],[43,64.62],[44,64.67],[45,64.54],[46,64.52],[47,64.5],[49,64.5],[50,64.52],[51,64.52],[52,64.52],[53,64.41],[54,64.36],[55,64.305],[57,64.34],
[58,64.34],[59,64.38],[61,64.35],[62,64.35],[64,64.35],[65,64.35],[66,64.32],[69,64.3196],[70,64.38],[71,64.38],[72,64.26],[73,64.21],[74,64.15],[75,64.15],[76,64.04],[77,63.96],[78,63.97],[79,63.89],[80,63.934],[81,63.99],[82,64],[83,63.91],[84,64.01],[86,64],[87,64.03],[88,64.03],[89,64.01],[91,64.03],[92,64.03],[93,64.1],[94,64.11],[95,64.13],[96,64.1],[97,64.075],[98,64.09],[99,64.07],[100,64.03],[101,64.03],[102,64.025],[104,64.03],[105,64.01],[106,64.08],[108,64.085],[109,64.08],[110,64.065],
[111,64.07],[112,64.03],[113,64.03],[114,64.06],[115,64.1],[116,64.085],[117,64.09],[118,64.14],[120,64.1],[121,64.055],[122,64.085],[123,64.08],[124,64.05],[125,64.07],[126,64.09],[127,64.06],[128,64.08],[129,64.09],[130,64.12],[131,64.12],[132,64.1],[133,64.12],[134,64.13],[135,64.19],[136,64.2],[137,64.21],[138,64.19],[139,64.205],[140,64.2],[141,64.24],[142,64.22],[143,64.2],[144,64.2],[145,64.2],[146,64.185],[147,64.18],[148,64.2],[149,64.2],[150,64.205],[151,64.24],[152,64.225],[153,64.19],
[154,64.255],[155,64.29],[156,64.26],[157,64.245],[158,64.25],[159,64.27],[160,64.29],[161,64.3],[162,64.31],[164,64.248],[165,64.23],[166,64.21],[167,64.2],[168,64.23],[169,64.23],[170,64.24],[173,64.22],[174,64.23],[176,64.249],[177,64.27],[178,64.28],[180,64.28],[181,64.26],[182,64.27],[185,64.31],[186,64.3],[187,64.3],[188,64.28],[191,64.295],[192,64.295],[194,64.32],[195,64.34],[196,64.36],[197,64.37],[198,64.41],[199,64.43],[200,64.44],[201,64.46],[202,64.45],[203,64.4],[204,64.43],[205,64.44],
[206,64.43],[207,64.43],[208,64.435],[209,64.47],[212,64.46],[213,64.46],[214,64.45],[215,64.45],[216,64.46],[217,64.5],[218,64.5],[219,64.52],[220,64.52],[221,64.5011],[222,64.52],[224,64.52],[225,64.4925],[226,64.5],[227,64.54],[228,64.61],[229,64.63],[230,64.63],[231,64.63],[232,64.73],[235,64.71],[236,64.76],[237,64.79],[238,64.8],[239,64.7675],[240,64.71],[241,64.67],[242,64.69],[243,64.66],[244,64.66],[245,64.62],[246,64.645],[247,64.62],[248,64.61],[249,64.59],[250,64.59],[251,64.59],[252,
64.59],[253,64.59],[254,64.59],[255,64.58],[256,64.62],[261,64.655],[262,64.65],[264,64.64],[265,64.65],[266,64.59],[267,64.56],[268,64.57],[269,64.59],[270,64.585],[271,64.56],[272,64.54],[273,64.56],[274,64.57],[275,64.59],[277,64.59],[278,64.61],[279,64.64],[280,64.65],[282,64.69],[283,64.67],[284,64.68],[285,64.66],[286,64.64],[287,64.58],[288,64.55],[289,64.55],[290,64.55],[292,64.5525],[293,64.57],[294,64.58],[295,64.58],[296,64.5905],[297,64.57],[298,64.55],[300,64.56],[301,64.59],[302,64.61],
[304,64.62],[305,64.62],[306,64.635],[307,64.64],[308,64.639],[309,64.639],[310,64.65],[311,64.67],[312,64.7],[313,64.69],[314,64.71],[315,64.7],[316,64.72],[317,64.73],[318,64.69],[320,64.72],[321,64.74],[322,64.81],[323,64.78],[324,64.78],[325,64.77],[326,64.77],[327,64.8],[328,64.8],[329,64.775],[330,64.73],[331,64.75],[333,64.72],[334,64.71],[335,64.7175],[336,64.73],[337,64.74],[338,64.8],[339,64.84],[340,64.8],[341,64.78],[342,64.8],[344,64.81],[345,64.83],[346,64.83],[347,64.87],[349,64.87],
[351,64.92],[352,64.88],[353,64.88],[354,64.88],[355,64.86],[356,64.8699],[357,64.805],[358,64.81],[359,64.8],[360,64.74],[361,64.75],[364,64.8],[365,64.78],[366,64.79],[368,64.805],[369,64.78],[371,64.795],[372,64.78],[373,64.76],[374,64.77],[376,64.78],[377,64.78],[378,64.7798],[379,64.77],[380,64.74],[381,64.75],[382,64.75],[383,64.75],[384,64.73],[385,64.75],[386,64.78],[387,64.755],[388,64.76],[393,64.77],[2,64.64],[3,64.66],[4,64.52],[5,64.39],[6,64.23],[7,64.2],[8,64.28],[9,64.27],[10,64.3],
[11,64.235],[12,64.34],[13,64.5],[14,64.5499],[15,64.67],[16,64.7],[17,64.78],[18,64.81],[19,64.68],[21,64.72],[22,64.8],[23,64.87],[24,64.77],[25,64.715],[26,64.57],[27,64.77],[28,64.65],[29,64.78],[30,64.81],[31,64.76],[32,64.78],[33,64.77],[34,64.69],[35,64.69],[36,64.62],[37,64.57],[38,64.57],[39,64.59],[40,64.56],[41,64.62],[42,64.67],[43,64.62],[44,64.67],[45,64.54],[46,64.52],[47,64.5],[49,64.5],[50,64.52],[51,64.52],[52,64.52],[53,64.41],[54,64.36],[55,64.305],[57,64.34],[58,64.34],[59,64.38],
[61,64.35],[62,64.35],[64,64.35],[65,64.35],[66,64.32],[69,64.3196],[70,64.38],[71,64.38],[72,64.26],[73,64.21],[74,64.15],[75,64.15],[76,64.04],[77,63.96],[78,63.97],[79,63.89],[80,63.934],[81,63.99],[82,64],[83,63.91],[84,64.01],[2,64.64],[3,64.66],[4,64.52],[5,64.39],[6,64.23],[7,64.2],[8,64.28],[9,64.27],[10,64.3],[11,64.235],[12,64.34],[13,64.5]];a.metric(function(a){return b.metric(function(b,a,d,h){b=[];for(a=0;a<c.length;a++)b.push(c[a][1]);h(null,b)},a)});d3.select("#chart2").selectAll(".horizon").data(["global"]).enter().append("div").attr("class",
"horizon").call(a);d3.select("#cuerpo").append("div").attr("class","rule").call(b.rule());b.on("focus",function(a){d3.selectAll(".value").style("right",null==a?null:b.size()-a+"px")});a=b.axis();d3.select("#cuerpo").append("div").attr("class","axis").append("g").call(a)},recupera_datos:function(){gapi.auth.authorize({client_id:"351031765602-p92d119k9mhn04b9i9v908gjav59blrn.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/datastore  https://www.googleapis.com/auth/userinfo.email",
immediate:!1},function(b){b&&!b.error&&gapi.client.load("datastore","v1beta2").then(function(){console.log("loaded.");gapi.client.datastore.datasets.runQuery({datasetId:"groovy-legacy-814",resource:{query:{kinds:[{name:"Ind_Datapoint"}],filter:{propertyFilter:{property:{name:"Ind_Datapoint_owner"},operator:"equal",value:{stringValue:"macarbox003@gmail.com/pi_black:"}}},limit:770}}}).then(function(a){sessionStorage.setItem("datos_almacen",JSON.stringify(a.result));var b=a.result.batch.entityResults;
console.debug(b);b=b.length;console.debug(b);for(var d=0;d<b;d++){var e=a.result.batch.entityResults[d].entity.properties.Ind_Datapoint_data_timestamp.dateTimeValue,f=a.result.batch.entityResults[d].entity.properties.Ind_Datapoint_owner.stringValue,g=window.atob(a.result.batch.entityResults[d].entity.properties.Ind_Datapoint_data_value.blobValue),g=JSON.parse(g).Core_Temp;console.debug("Temperatura: ",e,f,g)}},function(b){console.log("Error: "+b.result.error.message)})})})},recupera_datos2:function(){var b=
[];gapi.auth.authorize({client_id:"351031765602-p92d119k9mhn04b9i9v908gjav59blrn.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/datastore  https://www.googleapis.com/auth/userinfo.email",immediate:!1},function(a){a&&!a.error&&(alert("pasa511"),gapi.client.load("datastore","v1beta2").then(function(){console.log("loaded.");gapi.client.datastore.datasets.runQuery({datasetId:"groovy-legacy-814",resource:{query:{kinds:[{name:"Ind_Datapoint"}],filter:{propertyFilter:{property:{name:"Ind_Datapoint_owner"},
operator:"equal",value:{stringValue:"macarbox003@gmail.com/pi_black:"}}},limit:770}}}).then(function(a){for(var d=a.result.batch.entityResults.length,e=0;e<d;e++){var f=a.result.batch.entityResults[e].entity.properties.Ind_Datapoint_data_timestamp.dateTimeValue,g=window.atob(a.result.batch.entityResults[e].entity.properties.Ind_Datapoint_data_value.blobValue),g=JSON.parse(g).Core_Temp,h={};h.fecha=f;h.temperatura=g;b.push(h)}var k=cubism.context().serverDelay(0).clientDelay(0).step(1E4).size($("#chart2").width()).stop();
a=k.horizon().extent([0,50]).height(50).mode("offset");a.metric(function(a){return k.metric(function(a,c,e,d){a=[];for(c=0;c<b.length;c++)a.push(b[c].temperatura);console.log("cargados:",a.length);d(null,a)},a)});d3.select("#chart2").selectAll(".horizon").data(["global"]).enter().append("div").attr("class","horizon").call(a);d3.select("#cuerpo").append("div").attr("class","rule").call(k.rule());k.on("focus",function(a){d3.selectAll(".value").style("right",null==a?null:k.size()-a+"px")});a=k.axis();
d3.select("#cuerpo").append("div").attr("class","axis").append("g").call(a)},function(a){console.log("Error: "+a.result.error.message)})}))})},open_channel:function(){$.ajax("/token/",{success:function(b,a,c){remoht.token=b.token;remoht.channel=new goog.appengine.Channel(remoht.token);remoht.mensajes=[];remoht.channel.open({onopen:function(){console.debug("Channel opened",arguments)},onmessage:function(a){console.debug("Channel message",a);try{var c=[];b=JSON.parse(a.data);console.debug("received xmpp on..:",
b.datestamp_msg);console.debug("received cmd is ......:",b.cmd);c[0]=b.datestamp_msg;c[1]=b.from_msg;c[2]=b.cmd;c[3]=b.data;c[4]="Twitter Feed";remoht.mensajes.push(c);5<remoht.mensajes.length&&remoht.mensajes.shift();$("#debug_msg4").text(remoht.mensajes[0][0]);$("#debug_msg_from4").text(remoht.mensajes[0][1]);$("#xmpp_msg_type4").text(remoht.mensajes[0][2]);$("#xmpp_msg_data4").text(remoht.mensajes[0][3]);1<remoht.mensajes.length&&($("#debug_msg3").text(remoht.mensajes[1][0]),$("#debug_msg_from3").text(remoht.mensajes[1][1]),
$("#xmpp_msg_type3").text(remoht.mensajes[1][2]),$("#xmpp_msg_data3").text(remoht.mensajes[1][3]));2<remoht.mensajes.length&&($("#debug_msg2").text(remoht.mensajes[2][0]),$("#debug_msg_from2").text(remoht.mensajes[2][1]),$("#xmpp_msg_type2").text(remoht.mensajes[2][2]),$("#xmpp_msg_data2").text(remoht.mensajes[2][3]));3<remoht.mensajes.length&&($("#debug_msg1").text(remoht.mensajes[3][0]),$("#debug_msg_from1").text(remoht.mensajes[3][1]),$("#xmpp_msg_type1").text(remoht.mensajes[3][2]),$("#xmpp_msg_data1").text(remoht.mensajes[3][3]));
4<remoht.mensajes.length&&($("#debug_msg").text(remoht.mensajes[4][0]),$("#debug_msg_from").text(remoht.mensajes[4][1]),$("#xmpp_msg_type").text(remoht.mensajes[4][2]),$("#xmpp_msg_data").text(remoht.mensajes[4][3]));remoht.channel_commands[b.cmd](b.data)}catch(f){console.warn("Channel onmessage error",f)}},onerror:function(a){console.warn(a);remoht.open_channel()},onclose:function(){console.debug("Channel closed")}})}})},start_demo:function(){remoht.current_device_id="DUMMY";$("#device_header .device_name").text("(this is demo mode!)");
remoht.add_device_to_list({id:"DUMMY",resource:"dummy_device",presence:"availablie"});remoht.show_relays("DUMMY",{relay_1:0,relay_2:1});var b={device_id:"DUMMY",light_pct:80,temp_c:23.4};rand=function(a,b){return Math.random()*(b-a)+a};window.setInterval(function(){b.light_pct=Math.max(0,Math.min(1,b.light_pct/100+rand(-.03,.03)));b.temp_c=Math.round(100*Math.max(5,Math.min(40,b.temp_c+rand(-2,2))))/100;remoht.channel_commands.readings(b)},2E3)},start_demo_d:function(){remoht.current_device_id="DUMMY";
$("#device_header .device_name").text("(this is demo mode!)");remoht.add_device_to_list({id:"DUMMY",resource:"dummy_device",presence:"availablie"});remoht.show_relays("DUMMY",{relay_1:0,relay_2:1});var b={device_id:"DUMMY",light_pct:80,temp_c:23.4,otro_1:40,otro_2:0};rand=function(a,b){return Math.random()*(b-a)+a};window.setInterval(function(){b.light_pct=Math.max(0,Math.min(1,b.light_pct/100+rand(-.03,.03)));b.temp_c=Math.round(100*Math.max(5,Math.min(40,b.temp_c+rand(-2,2))))/100;b.otro_1=Math.max(0,
Math.min(1,b.light_pct/100+rand(-.05,.05)));remoht.channel_commands.readings(b)},2E3)}};
